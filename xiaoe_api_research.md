# 小鹅通内容获取方案研究

## 1. 官方API方案

### 可用API接口
根据小鹅通开放平台文档（https://api-doc.xiaoe-tech.com/），提供以下相关API：

- **查询商品列表2.0** - 获取店铺所有商品
- **商品详情2.0** - 获取单个商品详细信息
- **查询组合课资源列表4.0** - 获取课程内容列表
- **获取训练营营期任务** - 获取训练营任务信息

### API使用要求
1. 需要创建应用并获得授权
2. 需要获取 `access_token`
3. 需要配置IP白名单
4. 部分API需要申请权限集

### 限制
- 官方API主要用于商家自己的店铺数据管理
- **无法直接获取他人店铺的内容**（需要店铺授权）
- 无法获取视频文件下载链接（只能获取元数据）

## 2. 第三方下载工具方案

### 已知工具
从搜索结果发现多个小鹅通下载工具：

1. **PyJun/xiaoetech_downlaoder** (GitHub)
   - Python实现的小鹅通视频课程下载工具
   - 可以下载已购买的付费课程
   - 解决课程过期后无法观看的问题

2. **学无止下载器** (用户提供的截图)
   - 支持批量下载小鹅通课程视频
   - 需要登录账号
   - 支持会员免费下载

### 工作原理
这些工具通常通过以下方式工作：
1. 模拟浏览器登录小鹅通
2. 获取课程页面的视频播放链接
3. 解析M3U8视频流或直接下载MP4
4. 使用ffmpeg合并视频片段

## 3. 浏览器自动化方案

### 方案概述
使用浏览器自动化工具（Selenium/Playwright）：
1. 自动登录小鹅通账号
2. 定期检查课程更新
3. 自动下载新发布的图文和视频
4. 提取图文内容和视频文件

### 优势
- 无需官方API授权
- 可以获取所有已购买的内容
- 可以提取图文、视频、音频等多种格式

### 挑战
- 需要维护登录状态
- 可能需要处理验证码
- 需要解析页面结构（可能变化）

## 4. 推荐方案

### 方案A: 浏览器自动化 + 内容监控（推荐）

**适用场景**：猫哥每天发布图文和视频

**实现步骤**：
1. 使用Playwright自动登录小鹅通
2. 定时检查课程列表（每小时或每天）
3. 检测新发布的内容
4. 自动下载图文截图和视频文件
5. 触发图文解读系统分析
6. 推送结果到企业微信

**优势**：
- ✅ 完全自动化
- ✅ 无需API授权
- ✅ 可以获取所有内容类型
- ✅ 可以集成到现有系统

### 方案B: 手动上传 + 快速处理

**适用场景**：每天手动保存图文

**实现步骤**：
1. 在小鹅通查看猫哥图文
2. 截图或保存图片
3. 通过网页上传到分析系统
4. 系统自动分析并推送结果

**优势**：
- ✅ 简单可靠
- ✅ 无技术风险
- ✅ 已经实现（网页上传）

### 方案C: 企业微信机器人转发

**适用场景**：猫哥在企业微信群发布

**实现步骤**：
1. 配置企业微信机器人
2. 监听群消息
3. 自动提取图片
4. 触发分析系统

**优势**：
- ✅ 零延迟
- ✅ 完全自动化
- ✅ 无需访问小鹅通

## 5. 技术实现细节

### 浏览器自动化示例代码结构

```python
from playwright.sync_api import sync_playwright
import time
import os

class XiaoeMonitor:
    def __init__(self, username, password):
        self.username = username
        self.password = password
        self.last_check_time = None
        
    def login(self, page):
        """登录小鹅通"""
        page.goto("https://appqpljfemv4802.h5.xiaoeknow.com/")
        # 输入账号密码
        # 处理登录流程
        
    def get_latest_content(self, page):
        """获取最新内容"""
        # 访问课程列表
        # 检查发布时间
        # 下载新内容
        
    def download_image(self, url, save_path):
        """下载图文"""
        # 下载并保存图片
        
    def monitor_loop(self):
        """监控循环"""
        with sync_playwright() as p:
            browser = p.chromium.launch(headless=True)
            page = browser.new_page()
            
            self.login(page)
            
            while True:
                new_content = self.get_latest_content(page)
                if new_content:
                    # 触发分析系统
                    pass
                    
                time.sleep(3600)  # 每小时检查一次
```

## 6. 下一步行动

根据您的需求，建议：

1. **短期方案**：继续使用网页上传（已实现）
2. **中期方案**：开发浏览器自动化监控工具
3. **长期方案**：如果猫哥在企业微信群发布，配置机器人自动转发

需要我帮您实现哪个方案？
